/**
 * Style up the Galleries.
 *
 * This file accounts for both the gallery shortcode
 * and galleries included by the block editor.
 *
 * The markup is slightly different but we have the
 * technology to work around that.
 *
 * Default to eight columns. Any galleries set with
 * a greater number of columns will display the maximum
 * number of columns allowed.
 *
 * If the number of columns is incorrectly set, eg `columns=""`
 * in the shortcode, the default value will be hit but the user
 * is running outside of the warranty if they do that.
 *
 * `min-width` is used throughout in combination with
 * flex-basis to create faux container queries for the
 * galleries. The minimum size for a gallery item is 9rem.
 */

.gallery,
.wp-block-gallery {
	display: flex;
	flex-wrap: wrap;
	margin-left: -1rem;

	// Block editor is a list, reset those styles.
	list-style: none;
	padding-left: 0;
}

.gallery-item,
.wp-block-gallery .blocks-gallery-item {
	/*
	 * Default to eight columns as catch-all when eight or more
	 * columns are set.
	 */
	min-width: calc( ( 100% / 8 ) - 1rem );
	width: auto; // Required for blocks.
	margin-left: 1rem;
	margin-bottom: 1rem;
	margin-right: 0; // Required for blocks.
	flex-grow: 1;
	flex-shrink: 1;
	flex-basis: 9rem; // Minimum image width.
	position: relative;
	display: flex;
	flex-direction: column;
	justify-content: flex-end;
}

// The figure is nested in the block editor gallery.
.wp-block-gallery .blocks-gallery-item figure {
	min-width: 100%;
	margin-top: 0;
	margin-bottom: 0;
}

%gallery-block-gallery-icon,
.gallery-icon,
.wp-block-gallery .blocks-gallery-item a,
.wp-block-gallery .blocks-gallery-item img {
	display: block;
	width: 100%;
}

%gallery-block-gallery-caption,
.gallery-caption,
.wp-block-gallery .blocks-gallery-item figcaption {
	display: block;
	left: 0;
	right: 0;
	bottom: 0;
	width: auto; // Required for blocks.

	@include frontend() {
		position: absolute;
	}

	font-size: 0.74rem;
	color: $color-white;
	text-align: left; // Required for blocks.

	/*
	 * 0.55 opacity is the least transparent the background can be while meeting
	 * WGAG 2 Level AA for any size of white text.
	 *
	 * @see https://contrast-ratio.com/#white-on-rgba%280%2C0%2C0%2C0.55%29
	 *
	 * The second color stop of the gradient should match the siz of the top
	 * padding for the caption.
	 */
	background-image: linear-gradient( to bottom, rgba( 0, 0, 0, 0 ), rgba( 0, 0, 0, 0.55 ) 1em );
	padding: 1em .5em .5em;
}

@for $i from 1 through 7 {
	.gallery-columns-#{ $i } > .gallery-item,
	.wp-block-gallery.columns-#{ $i } > .blocks-gallery-item {
		min-width: calc( ( 100% / #{ $i } ) - 1rem );
		margin-right: 0; // Required for blocks.
	}
}

/*
 * The short code [gallery] always displays images as though the
 * `is-cropped` class has been applied. Specificity hacks are used
 * to match the specificity of the block editor's selectors.
 *
 * The block editor version depends on the setting checked by the user.
 */
.wp-block-gallery.is-cropped .blocks-gallery-item figure,
.gallery-icon.gallery-icon {
	display: flex;
	flex: 1;
	width: 100%;

	a,
	img {
		flex: 1;
		object-fit: cover;
		height: 100%;
		width: 100%;
	}
}

@include editor() {
	/*
	 * The code above messes up the editor styles so this resets the right
	 * margin in the editor with the required specificity.
	 */
	.wp-block-gallery .blocks-gallery-item.blocks-gallery-item {
		margin-right: 0;
	}


}
